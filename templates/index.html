<!-- <body>
    <h1> Python Fetch Example</h1>
    <p id='embed'>{{test}}</p>
    <p id='mylog'/>
    <script>
    fetch('/test')
      .then(function (response) {
          return response.json();
      }).then(function (text) {
          console.log('GET response:');
          console.log(text.greeting); 
      });
    </script>
    <body> -->
        <head>
            <!-- CSS only -->
            <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
            <link href = "{{ url_for('static', filename='css/index.css') }}" rel="stylesheet">
            <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>
            <script src="https://d3js.org/d3.v4.js"></script>
        </head>
        <body>  
            <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
    Launch static backdrop modal
  </button>

  <div class="main">
    <div class="heatmap" id="heatmap">
    </div>
    <div class="local_view">
    </div>
    <div class="img_grid" id="img_grid">

    </div>

  </div>
  
  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="width:80vw">
    <div class="modal-dialog modal-xl modal-dialog-scrollable" style="width:80vw">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="staticBackdropLabel">Select Samples</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            {%for i in range(0, len)%}
                <!-- <a onclick="select_im" data-arg1=i> -->

                    {% set function_i = "select_im("+ ids[i] + ")" %}
                    <img class="sel_im" src={{samples[ids[i]|int()]}} id={{ids[i]}} alt="" width="150px" height="150px" onclick={{function_i}} data-arg1=i>
            {%endfor%}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-info" id="selectall_button">Select All</button>
          <button type="button" class="btn btn-secondary" id="unselect_button">Unselect all</button>
          <button type="button" class="btn btn-primary" data-bs-dismiss="modal" id="visualize_button">Select</button>
        </div>
      </div>
    </div>
  </div>      

  <script>
      // global var to store selected
      var selected = [];
      var DATA = [];
      function select_im(i) {
        var index = selected.indexOf(i);
        if (index > -1) {
          selected.splice(index, 1);
          var element = document.getElementById(i);
          element.style.border = "0px";
        }
        else {
          selected.push(i);
          var element = document.getElementById(i);
          element.style.border = "10px solid red";
        }
        console.log(selected);
      }

      // select all imgs
      $("#selectall_button").click(function(){
        selected = [];
        $(".sel_im").each(function(i, x){
          this.style.border = "10px solid red";
          selected.push(this.id);
        });
        
      });

      // unselect all selected items
      $("#unselect_button").click(function(){
        $(".sel_im").each(function(){
          this.style.border = "0px";
        });
        selected = [];
      });

      // visualize selected items in modal
      $("#visualize_button").click(function(){
        $.ajax({ async: false,
          url:'{{url_for("array_post")}}',
          type:'post',
          data:{selected:selected},
          success:function(res){
            // remove all previously viewed elements
            var img_grid = document.getElementById("img_grid");
            img_grid.innerHTML = "";
            // display photos in bottom corner
            selected.forEach((x, i) => {
              var img = document.createElement("img");
              var disp_img = document.getElementById(x);
              img.src = disp_img.src;
              var img_grid = document.getElementById("img_grid");
              img_grid.appendChild(img);
              
            });
          }
          
        });
        $.get('{{url_for("array_post")}}', function( data ) {
            DATA = data.mat;
            build_heatmap();
            
        });
        
            
    });

    // dynamic resizing of hetamp
    var height = document.getElementById("heatmap").offsetHeight;
    var width = document.getElementById("heatmap").offsetWidth;
    function resizeheatmap() {
      
      height = document.getElementById("heatmap").getBoundingClientRect().height;
      width =  document.getElementById("heatmap").getBoundingClientRect().width;
      console.log("resize", width, height);
      build_heatmap();
    }
    window.addEventListener('resize', resizeheatmap);


    // heatmap visualization
    var margin = {top: 5, right: 5, bottom: 5, left: 5}
    

    function build_heatmap() {
      // remove previous elements
      console.log("build", width, height);
      d3.select("#heatmap_g")
        .selectAll("*").remove();
      // resize
      d3.select("#heatmap_svg")
        .attr("width", width)
        .attr("height", height);

      if (DATA.length == 0){
        return;
      }
      
      var x = d3.scaleLinear()
              .range([0, width])
              .domain([0,DATA.length]);

      var y = d3.scaleLinear()
          .range([0, height])
          .domain([0,DATA.length]);

      var row = svg.selectAll(".row")
        .data(DATA)
          .enter().append("g")
            .attr("class", "row");
      
      var col = row.selectAll(".cell")
          .data(function (d,i) {return d.map(function(a){return {value: a, row: i};})})
            .enter().append("rect")
              .attr("class", "cell")
              .attr("x", function(d, i) { return x(i); })
              .attr("y", function(d, i) { return y(d.row); })
              .attr("width", ()=>{return width/DATA.length;})
              .attr("height", ()=>{return width/DATA.length;})
              .style("fill", function(d) { return myColor(d.value);});
    };

    // append the svg object to the body of the page
    var svg = d3.select("#heatmap")
      .append("svg")
        .attr("id", "heatmap_svg")
        .attr("width", width)
        .attr("height", height)
          .append("g")
            .attr("id", "heatmap_g")
      // Build color scale
      var myColor = d3.scaleLinear()
        .range(["white", "#69b3a2"])
        .domain([0,1])
    

    // warn user before reloading
    window.onbeforeunload = function() {
      return "Data will be lost if you leave the page, are you sure?";
    };
    
  </script>
</body>